<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NOT.ESP QUIZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      text-align: center;
      padding: 40px 20px;
      box-sizing: border-box;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    #score {
      font-size: 1.2em;
      margin-bottom: 20px;
      color: #FFD700;
    }
    .quiz-box {
      background-color: rgba(255, 255, 255, 0.08);
      padding: 30px;
      border-radius: 15px;
      display: inline-block;
      max-width: 100%;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
      position: relative;
    }
    .choices-container {
      position: relative;
      margin-top: 20px;
    }
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 1);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5em;
      border-radius: 10px;
      cursor: pointer;
      z-index: 10;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .prompt {
      font-size: 4em;
      margin-bottom: 30px;
      word-wrap: break-word;
    }
    .choices {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .choices button {
      background-color: #333;
      color: white;
      border: none;
      padding: 15px 25px;
      margin: 10px;
      font-size: 1.2em;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      flex: 1 1 calc(50% - 20px);
      max-width: 200px;
    }
    .choices button:hover {
      background-color: #5c6bc0;
      transform: scale(1.05);
    }
    .emoji-button {
      font-size: 2.5em !important;
      padding: 15px 0 !important;
    }
    #result {
      font-size: 1.5em;
      margin-top: 20px;
    }
    button {
      margin-top: 20px;
      font-size: 1em;
      padding: 10px 20px;
      background-color: #666;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      margin-right: 10px;
    }
    #editorModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      color: white;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
      overflow: auto;
      z-index: 100;
    }
    #editorBody {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      max-width: 800px;
      width: 100%;
      margin-top: 20px;
    }
    .editor-entry {
      display: flex;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      width: calc(50% - 20px);
      box-sizing: border-box;
    }
    .editor-entry input {
      margin-left: 10px;
      width: 100%;
      padding: 5px 10px;
      border-radius: 5px;
      border: none;
      font-size: 1em;
    }
    .editor-entry span {
      font-size: 2em;
    }
  </style>
</head>
<body>
  <h1>NOT.ESP QUIZ</h1>
  <div id="score">Correct: 0 | Wrong: 0 | Total: 0</div>
  <div class="quiz-box">
    <div class="prompt" id="prompt"></div>
    <div class="choices-container">
      <div class="overlay" id="overlay" onclick="revealChoices()">Tap to Reveal</div>
      <div class="choices" id="choices"></div>
    </div>
    <div id="result"></div>
    <button onclick="toggleMode()" id="mode-toggle">Switch Mode</button>
    <button onclick="toggleReviewMode()" id="review-toggle">Toggle Review Mode</button>
    <button onclick="openEditor()">Edit Icons</button>
    <button onclick="resetToDefault()">Reset to Default</button>
    <button onclick="downloadJSON()">Download Words</button>
    <input type="file" id="jsonFile" style="display:none" onchange="uploadJSON(event)">
    <button onclick="document.getElementById('jsonFile').click()">Upload Words</button>
  </div>

  <div id="editorModal">
    <h2>Edit Icon-Word Pairs</h2>
    <div id="editorBody"></div>
    <div style="margin-top: 20px;">
      <button onclick="saveAdvancedEdits()">Save & Apply</button>
      <button onclick="closeEditor()">Cancel</button>
    </div>
  </div>

  <script>
    let data = {};
    let entries = [];
    let scoreCorrect = 0, scoreWrong = 0;
    let isWordMode = false;
    let reviewMode = false;
    let reviewLog = [];
    let correctAnswer = null;

    const defaultData = {
      "üî¥": "wonderful", "‚ûï": "towards", "üåä": "free", "üî∫": "fair choice",
      "üü®": "fantastic", "‚≠ê": "finally", "üßç‚Äç‚ôÇÔ∏è": "human", "üòÄ": "zoomed",
      "‚ù§Ô∏è": "affectionate", "üö§": "serene", "üè†": "wholesome", "üö¥‚Äç‚ôÇÔ∏è": "movement",
      "üöó": "speed", "üöÇ": "momentum", "‚úàÔ∏è": "take flight", "üöÄ": "outer space",
      "‚õ©": "surface", "üì∫": "visual", "‚òéÔ∏è": "communicate", "üìñ": "literature",
      "üç∑": "drink from", "‚úèÔ∏è": "artistic", "üîê": "security", "‚è∞": "keeping time",
      "üî™": "sharp", "üî´": "lethal", "üå≥": "natural", "üåª": "organic",
      "‚òÄÔ∏è": "painting", "üåô": "night sky", "üåßÔ∏è": "weather", "‚ö°": "powerful",
      "üê∂": "loyal", "üê±": "living", "üêü": "underwater", "ü¶ú": "in the sky",
      "üëΩ": "weirdly", "üëª": "spooky", "üíÄ": "morbid", "üìù": "nothing",
      "üñï": "offensive", "üö´": "negative", "üçÜ": "strangely"
    };

    function loadData(obj, persist = true) {
      data = obj;
      entries = Object.entries(data);
      if (persist) localStorage.setItem('notesp-quiz', JSON.stringify(data));
      updateScore();
      generateQuestion();
    }

    function resetToDefault() {
      if (confirm("Are you sure you want to reset to the default icon-word pairs? This will erase all your current data.")) {
        loadData(defaultData);
      }
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `notesp-quiz-${new Date().toISOString().slice(0,10)}.json`;
      a.click();
    }

    function uploadJSON(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const obj = JSON.parse(reader.result);
          loadData(obj);
        } catch {
          alert("Invalid JSON format.");
        }
      };
      reader.readAsText(file);
    }

    function updateScore() {
      const total = scoreCorrect + scoreWrong;
      document.getElementById("score").textContent = `Correct: ${scoreCorrect} | Wrong: ${scoreWrong} | Total: ${total}`;
    }

    function revealChoices() {
      document.getElementById("overlay").classList.add("hidden");
    }

    function generateQuestion() {
      const container = document.getElementById("choices");
      container.innerHTML = "";
      document.getElementById("result").textContent = "";
      document.getElementById("overlay").classList.remove("hidden");

      const [emoji, word] = entries[Math.floor(Math.random() * entries.length)];
      correctAnswer = isWordMode ? emoji : word;
      document.getElementById("prompt").textContent = isWordMode ? word : emoji;

      const options = new Set([correctAnswer]);
      while (options.size < 5) {
        const rand = entries[Math.floor(Math.random() * entries.length)];
        const opt = isWordMode ? rand[0] : rand[1];
        options.add(opt);
      }

      [...options].sort(() => Math.random() - 0.5).forEach(choice => {
        const button = document.createElement("button");
        button.innerHTML = choice;
        button.className = isWordMode ? "emoji-button" : "";
        button.onclick = () => checkAnswer(choice, button);
        container.appendChild(button);
      });
    }

    function checkAnswer(selected, button) {
      document.querySelectorAll(".choices button").forEach(btn => btn.style.backgroundColor = "#333");
      button.style.backgroundColor = selected === correctAnswer ? "green" : "red";

      const result = document.getElementById("result");
      if (selected === correctAnswer) {
        scoreCorrect++;
        result.innerHTML = "‚úÖ Correct!";
      } else {
        scoreWrong++;
        result.innerHTML = `‚ùå Wrong! Correct answer was: <strong>${correctAnswer}</strong>`;
      }

      reviewLog.push({ question: document.getElementById("prompt").textContent, selected, correct: correctAnswer, wasCorrect: selected === correctAnswer });
      updateScore();
      setTimeout(() => { if (!reviewMode) generateQuestion(); }, 1500);
    }

    function toggleMode() {
      isWordMode = !isWordMode;
      document.getElementById("mode-toggle").textContent = isWordMode ? "Switch to Emoji Quiz" : "Switch to Word Quiz";
      generateQuestion();
    }

    function toggleReviewMode() {
      reviewMode = !reviewMode;
      if (reviewMode) {
        const container = document.getElementById("choices");
        container.innerHTML = "";
        document.getElementById("result").innerHTML = "<h3>Review</h3>";
        document.getElementById("prompt").textContent = '';
        reviewLog.slice(-10).reverse().forEach(entry => {
          const div = document.createElement("div");
          div.innerHTML = `<div style='margin: 5px 0;'>${entry.question} ‚Üí <strong>${entry.selected}</strong> ${entry.wasCorrect ? '‚úÖ' : `‚ùå (<em>${entry.correct}</em>)`}</div>`;
          container.appendChild(div);
        });
        document.getElementById("overlay").classList.add("hidden");
      } else generateQuestion();
    }

    function openEditor() {
      const container = document.getElementById("editorBody");
      container.innerHTML = "";
      Object.entries(data).forEach(([emoji, word], i) => {
        const entry = document.createElement("div");
        entry.className = "editor-entry";
        entry.innerHTML = `
          <span>${emoji}</span>
          <input type="text" value="${word}" data-emoji="${emoji}">
        `;
        container.appendChild(entry);
      });
      document.getElementById("editorModal").style.display = "flex";
    }

    function closeEditor() {
      document.getElementById("editorModal").style.display = "none";
    }

    function saveAdvancedEdits() {
      const newData = {};
      document.querySelectorAll("#editorBody input").forEach(input => {
        const emoji = input.getAttribute("data-emoji");
        const word = input.value.trim();
        if (emoji && word) newData[emoji] = word;
      });
      loadData(newData);
      closeEditor();
    }

    window.onload = () => {
      const saved = localStorage.getItem('notesp-quiz');
      loadData(saved ? JSON.parse(saved) : defaultData, false);
    }
  </script>
</body>
</html>
